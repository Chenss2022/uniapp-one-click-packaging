(()=>{"use strict";var e={8317:function(e,n,r){var o=this&&this.__awaiter||function(e,n,r,o){return new(r||(r=Promise))((function(t,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,s)}l((o=o.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.commandArr=n.Utils=void 0;const t=r(1808),a=r(7147);n.Utils=class{static getUseablePort(e){return o(this,void 0,void 0,(function*(){let n=yield new Promise(((n,r)=>{!function e(r){var o=new t.Socket;o.connect(r,(function(){o.destroy(),e(++r)})),o.on("error",(function(e){"ENOENT"!==e.code&&"ECONNREFUSED"!==e.code||n(r.toString())}))}(Number(e))}));return n}))}static getThemeFileName(e){switch(e){case"Default":default:return"github-markdown.css";case"Atom One Dark":return"atomonedark.css";case"Monokai":return"darkmark.css"}}static isExecutableFile(e,n){return n?a.existsSync(e)&&e.toLowerCase().endsWith(".app"):a.existsSync(e)&&e.toLowerCase().endsWith(".exe")&&a.statSync(e).isFile()}},n.commandArr=[{command:"mdPreviewInChrome",cmd:"start",isDarwin:!1},{command:"mdPreviewInChrome",cmd:"open",isDarwin:!0},{command:"mdPreviewInFirefox",cmd:"start",isDarwin:!1},{command:"mdPreviewInFirefox",cmd:"open",isDarwin:!0},{command:"mdPreviewInSafari",cmd:"open -a /Applications/Safari.app",isDarwin:!0},{command:"mdPreviewInIE",cmd:"start iexplore.exe",isDarwin:!1},{command:"mdPreviewInEdge",cmd:"start msedge.exe",isDarwin:!1}]},2717:(e,n,r)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.cancel=n.toSet=n.startFirefoxErrorTip=n.startChromeErrorTip=n.startError=void 0;const o=r(8472).loadMessageBundle(r(1017).join(__dirname,"i18n.ts"));n.startError=o(0,null),n.startChromeErrorTip=o(1,null),n.startFirefoxErrorTip=o(2,null),n.toSet=o(3,null),n.cancel=o(4,null)},389:function(e,n,r){var o=this&&this.__awaiter||function(e,n,r,o){return new(r||(r=Promise))((function(t,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,s)}l((o=o.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.deactivate=n.activate=void 0;const t=r(8472),a=r(9496),i=r(8171),s=r(7147),l=r(1017),c=r(2037),u=r(4579),d=r(2081),f=r(8317);t.config({messageFormat:t.MessageFormat.both,bundleFormat:t.BundleFormat.standalone})(r(1017).join(__dirname,"index.ts"));const g=r(2717);let m,p,v,w,h,b,y,x,F=!0,P="darwin"===c.platform(),S={},k=0;function C(e){this.subscriptions.push(i.workspace.registerWorkspaceFolderLauncher(e,(()=>({start(){return o(this,void 0,void 0,(function*(){yield j(),i.window.openPreview()}))}}))))}function E(e,n){this.subscriptions.push(i.workspace.registerWorkspaceFolderLauncher(e,(()=>({start:I(e,n)}))))}function I(e,n){return()=>o(this,void 0,void 0,(function*(){yield j();let r=_(!0);if("mdPreviewInChrome"===e){let e=i.workspace.getConfiguration().get("browsers.config")["Chrome.path"];if(e)if(f.Utils.isExecutableFile(e,P))P?(0,d.exec)(`${n} "${e}" "${r}"`):(0,d.execFile)(e,[r]);else{(yield i.window.showMessageBox({type:"error",title:g.startError,text:g.startChromeErrorTip,buttons:[g.toSet,g.cancel]}))==g.toSet&&i.workspace.gotoConfiguration("browsers.config.Chrome.path")}else P?(0,d.exec)(`${n} "/Applications/Google Chrome.app" "${r}"`):(0,d.exec)(`start chrome "${r}"`)}else if("mdPreviewInFirefox"===e){let e=i.workspace.getConfiguration().get("browsers.config")["Firefox.path"];if(e)if(f.Utils.isExecutableFile(e,P))P?(0,d.exec)(`${n} -a "${e}" "${r}"`):(0,d.execFile)(e,[r]);else{(yield i.window.showMessageBox({type:"error",title:g.startError,text:g.startFirefoxErrorTip,buttons:[g.toSet,g.cancel]}))==g.toSet&&i.workspace.gotoConfiguration("browsers.config.Firefox.path")}else P?(0,d.exec)(`${n} -a "/Applications/Firefox.app" "${r}"`):(0,d.exec)(`start firefox "${r}"`)}else(0,d.exec)(`${n} "${r}"`)}))}function _(e){var n;let r=i.workspace.getConfiguration(),o=a.window.activeTextEditor.document,t=o.languageId,s=l.normalize(o.uri.fsPath).toLowerCase(),c=l.normalize(o.workspaceFolder?o.workspaceFolder.uri.fsPath:l.dirname(s)).toLowerCase(),u=l.relative(c,s),d=l.relative(c,l.dirname(s)),g=f.Utils.getThemeFileName(r.get("editor.colorScheme")),m=(null===(n=o.workspaceFolder)||void 0===n?void 0:n.name)||"",v="";if(s=encodeURIComponent(s),m=encodeURIComponent(m),c=encodeURIComponent(c),u=u.replace(/\\/g,"/"),d=encodeURIComponent(d),"markdown"===t)v=`http://127.0.0.1:${p}/dcloudmdpaser?filename=${s}&theme=${g}&projectname=${m}&repath=${d}&isBrowser=${e||""}`;else if("html_es6"===t||"html"===t){let e=r.get("webServer.config").url,n=r.get("webServer.config").appendProjectName;v=m?e?`${e}${n?`/${m}`:""}/${u}`:`http://127.0.0.1:${p}/${m}/${u}`:decodeURIComponent(s)}return console.log("[nodeserver] [url]: "+v),v}function j(){return o(this,void 0,void 0,(function*(){if(!v){let e=yield f.Utils.getUseablePort("35929");v=(0,d.spawn)(process.argv[0],[l.join(__dirname,"/livereload.js"),w,b,p,e]),v.stdout.on("data",(e=>o(this,void 0,void 0,(function*(){let{type:n,data:r}=JSON.parse(e);if(n===u.EventType.Line){let e=r.line,n=a.window.activeTextEditor;if(n){let r=null==n?void 0:n.document;if("markdown"!==r.languageId)return;let o=r.lineAt(Number(e));F=!1,clearTimeout(m),n.revealRange(o.range),m=setTimeout((()=>{F=!0,clearTimeout(m)}),300)}}else if(n===u.EventType.StartLine)!function(){let e=a.window.activeTextEditor;if(e&&v){if("markdown"!==(null==e?void 0:e.document).languageId)return;let n=(e.visibleRanges[0].startLineNumber-1).toString();n&&O({type:u.EventType.StartLine,data:{startLine:n}})}}();else if(n===u.EventType.WsPort){let e=r.port;O({type:u.EventType.WsPort,data:{port:e}})}})))),v.stderr.on("data",(e=>{console.error("[nodeserver livereload error]"+e.toString())})),v.stdout.on("exit",(()=>{v=null})),i.window.onDidChangeTextEditorVisibleRanges((e=>{if(!F)return;if("markdown"!==e.textEditor.document.languageId)return;let n=(e.visibleRanges[0].startLineNumber-1).toString();O({type:u.EventType.Line,data:{line:n}})}))}}))}function O(e){v.stdin.write(JSON.stringify(e))}n.activate=function(e){return o(this,void 0,void 0,(function*(){let n=i.workspace.getConfiguration().get("builtin.web.server.port")||8848;p=yield f.Utils.getUseablePort(n),h=i.env.appData;let r=`${h}/nodeserver`;b=`${h}/extensions/nodeserver`,w=`${b}/router.json`,s.existsSync(r)&&s.rmSync(r,{recursive:!0}),s.existsSync(b)||s.mkdirSync(b,{recursive:!0}),["htmlPreviewUrl","markdownPreviewUrl"].forEach((e=>{i.workspace.registerPreviewUrlProvider(e,(()=>o(this,void 0,void 0,(function*(){return yield j(),yield new Promise(((e,n)=>{setTimeout((()=>{e("")}),30)})),_(!1)}))))})),i.commands.registerCommand("extension.ConfigWebServer",(()=>{i.workspace.gotoConfiguration("webServer.config.url")})),i.commands.registerCommand("extension.saveAutoRefreshBrowser",(()=>{i.workspace.getConfiguration().update("windows.runBrowserAutoRefresh",!i.workspace.getConfiguration().get("windows.runBrowserAutoRefresh"))})),function(){function e(){let e={};for(const n in S)e[n]=S[n].toLowerCase();s.writeFileSync(w,JSON.stringify(e,null,"\t"))}s.writeFileSync(w,""),i.workspace.workspaceFolders.forEach((e=>{let n=e.name,r=l.normalize(e.uri.fsPath);S[n]=r})),e(),i.workspace.onDidChangeWorkspaceFolders((function(n){n.added&&n.added.forEach((e=>{let n=e.name,r=l.normalize(e.uri.fsPath);S[n]=r})),n.removed&&n.removed.forEach((e=>delete S[e.name])),e()}))}(),i.workspace.onDidSaveTextDocument((function(e){let n=e.languageId;if(!["markdown","html","css","javascript"].includes(n))return;let r="markdown"==n,o="html"==n,t=i.workspace.getConfiguration().get("windows.runBrowserAutoRefresh");if(r||t)if(!e.workspaceFolder&&o){const n=decodeURIComponent(e.uri.toString());i.window.refreshPreview(n.toLowerCase())}else s.writeFileSync(`${b}/.filechanges`,l.normalize(e.fileName).toLowerCase())})),function(e){P?(E.call(e,"mdPreviewInChrome","open"),E.call(e,"mdPreviewInFirefox","open"),E.call(e,"mdPreviewInSafari","open -a /Applications/Safari.app")):(E.call(e,"mdPreviewInChrome","start"),E.call(e,"mdPreviewInFirefox","start"),E.call(e,"mdPreviewInIE","start iexplore.exe"),E.call(e,"mdPreviewInEdge","start msedge.exe"));C.call(e,"mdPreviewInnerBrowser")}(e);for(let{command:e,cmd:n,isDarwin:r}of f.commandArr)P===r&&i.commands.registerCommand(e,I(e,n));i.window.onDidOpenPreview((()=>o(this,void 0,void 0,(function*(){var e;if(k++,x)return;y=i.extensions.getExtension("chrome-base");let n=i.window.createOutputChannel();x={notify(e){return o(this,void 0,void 0,(function*(){const r=new URL(e.url);let o=/\/(.+?)\//.exec(r.pathname),t=decodeURIComponent(o[1]),a=S[t];e.sourceLine=decodeURIComponent(e.sourceLine).replace(`${t}/`,"");const s=i.extensions.getExtension("uniapp-extension"),{line:l,hyperlinks:c}=yield s.logToColorizeLog(Object.assign(Object.assign({},e),{projectDir:a,needAtLink:!0}));n.appendLine({line:l,hyperlinks:c,nocolor:!1})}))},url:`http://127.0.0.1:${p}`},null===(e=null==y?void 0:y.subscribeBuiltInConsoleAPICalled)||void 0===e||e.call(y,x)})))),i.window.onDidClosePreview((()=>{var e;k--,!k&&x&&(null===(e=null==y?void 0:y.unsubscribeBuiltInConsoleAPICalled)||void 0===e||e.call(y,x),x=null)}))}))},n.deactivate=function(){v.kill()}},4579:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.EventType=void 0,function(e){e.Line="line",e.StartLine="startLine",e.WsPort="wsPort",e.HttpPort="httpPort"}(n.EventType||(n.EventType={}))},800:(e,n,r)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.config=n.loadMessageBundle=n.localize=n.format=n.setPseudo=n.isPseudo=n.isDefined=n.BundleFormat=n.MessageFormat=void 0;var o,t=r(1926);function a(e){return void 0!==e}function i(e,r){return n.isPseudo&&(e="［"+e.replace(/[aouei]/g,"$&$&")+"］"),0===r.length?e:e.replace(/\{(\d+)\}/g,(function(e,n){var o=n[0],t=r[o],a=e;return"string"==typeof t?a=t:"number"!=typeof t&&"boolean"!=typeof t&&null!=t||(a=String(t)),a}))}!function(e){e.file="file",e.bundle="bundle",e.both="both"}(n.MessageFormat||(n.MessageFormat={})),function(e){e.standalone="standalone",e.languagePack="languagePack"}(n.BundleFormat||(n.BundleFormat={})),function(e){e.is=function(e){var n=e;return n&&a(n.key)&&a(n.comment)}}(o||(o={})),n.isDefined=a,n.isPseudo=!1,n.setPseudo=function(e){n.isPseudo=e},n.format=i,n.localize=function(e,n){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];return i(n,r)},n.loadMessageBundle=function(e){return(0,t.default)().loadMessageBundle(e)},n.config=function(e){return(0,t.default)().config(e)}},1926:(e,n)=>{var r;function o(){if(void 0===r)throw new Error("No runtime abstraction layer installed");return r}Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.install=function(e){if(void 0===e)throw new Error("No runtime abstraction layer provided");r=e}}(o||(o={})),n.default=o},8472:(e,n,r)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.config=n.loadMessageBundle=n.BundleFormat=n.MessageFormat=void 0;var o=r(1017),t=r(7147),a=r(1926),i=r(800),s=r(800);Object.defineProperty(n,"MessageFormat",{enumerable:!0,get:function(){return s.MessageFormat}}),Object.defineProperty(n,"BundleFormat",{enumerable:!0,get:function(){return s.BundleFormat}});var l,c,u=Object.prototype.toString;function d(e){return"[object Number]"===u.call(e)}function f(e){return"[object String]"===u.call(e)}function g(e){return JSON.parse(t.readFileSync(e,"utf8"))}function m(e){return function(n,r){for(var o=[],t=2;t<arguments.length;t++)o[t-2]=arguments[t];return d(n)?n>=e.length?void console.error("Broken localize call found. Index out of bounds. Stacktrace is\n: ".concat(new Error("").stack)):(0,i.format)(e[n],o):f(r)?(console.warn("Message ".concat(r," didn't get externalized correctly.")),(0,i.format)(r,o)):void console.error("Broken localize call found. Stacktrace is\n: ".concat(new Error("").stack))}}function p(e,n){return l[e]=n,n}function v(e,n){var r,a,i,s=o.join(c.cacheRoot,"".concat(e.id,"-").concat(e.hash,".json")),l=!1,u=!1;try{return r=JSON.parse(t.readFileSync(s,{encoding:"utf8",flag:"r"})),a=s,i=new Date,t.utimes(a,i,i,(function(){})),r}catch(e){if("ENOENT"===e.code)u=!0;else{if(!(e instanceof SyntaxError))throw e;console.log("Syntax error parsing message bundle: ".concat(e.message,".")),t.unlink(s,(function(e){e&&console.error("Deleting corrupted bundle ".concat(s," failed."))})),l=!0}}if(r=function(e,n){var r=c.translationsConfig[e.id];if(r){var t=g(r).contents,a=g(o.join(n,"nls.metadata.json")),i=Object.create(null);for(var s in a){var l=a[s],u=t["".concat(e.outDir,"/").concat(s)];if(u){for(var d=[],m=0;m<l.keys.length;m++){var p=l.keys[m],v=u[f(p)?p:p.key];void 0===v&&(v=l.messages[m]),d.push(v)}i[s]=d}else i[s]=l.messages}return i}}(e,n),!r||l)return r;if(u)try{t.writeFileSync(s,JSON.stringify(r),{encoding:"utf8",flag:"wx"})}catch(e){if("EEXIST"===e.code)return r;throw e}return r}function w(e){try{return function(e){var n=g(o.join(e,"nls.metadata.json")),r=Object.create(null);for(var t in n){var a=n[t];r[t]=a.messages}return r}(e)}catch(e){return void console.log("Generating default bundle from meta data failed.",e)}}function h(e,n){var r;if(!0===c.languagePackSupport&&void 0!==c.cacheRoot&&void 0!==c.languagePackId&&void 0!==c.translationsConfigFile&&void 0!==c.translationsConfig)try{r=v(e,n)}catch(e){console.log("Load or create bundle failed ",e)}if(!r){if(c.languagePackSupport)return w(n);var a=function(e){for(var n=c.language;n;){var r=o.join(e,"nls.bundle.".concat(n,".json"));if(t.existsSync(r))return r;var a=n.lastIndexOf("-");n=a>0?n.substring(0,a):void 0}if(void 0===n&&(r=o.join(e,"nls.bundle.json"),t.existsSync(r)))return r}(n);if(a)try{return g(a)}catch(e){console.log("Loading in the box message bundle failed.",e)}r=w(n)}return r}function b(e){if(!e)return i.localize;var n=o.extname(e);if(n&&(e=e.substr(0,e.length-n.length)),c.messageFormat===i.MessageFormat.both||c.messageFormat===i.MessageFormat.bundle){var r=function(e){for(var n,r=o.dirname(e);n=o.join(r,"nls.metadata.header.json"),!t.existsSync(n);){var a=o.dirname(r);if(a===r){n=void 0;break}r=a}return n}(e);if(r){var a=o.dirname(r),s=l[a];if(void 0===s)try{var u=JSON.parse(t.readFileSync(r,"utf8"));try{var d=h(u,a);s=p(a,d?{header:u,nlsBundle:d}:null)}catch(e){console.error("Failed to load nls bundle",e),s=p(a,null)}}catch(e){console.error("Failed to read header file",e),s=p(a,null)}if(s){var f=e.substr(a.length+1).replace(/\\/g,"/"),v=s.nlsBundle[f];return void 0===v?(console.error("Messages for file ".concat(e," not found. See console for details.")),function(){return"Messages not found."}):m(v)}}}if(c.messageFormat===i.MessageFormat.both||c.messageFormat===i.MessageFormat.file)try{var w=g(function(e){var n;if(c.cacheLanguageResolution&&n);else{if(i.isPseudo||!c.language)n=".nls.json";else for(var r=c.language;r;){var o=".nls."+r+".json";if(t.existsSync(e+o)){n=o;break}var a=r.lastIndexOf("-");a>0?r=r.substring(0,a):(n=".nls.json",r=null)}c.cacheLanguageResolution}return e+n}(e));return Array.isArray(w)?m(w):(0,i.isDefined)(w.messages)&&(0,i.isDefined)(w.keys)?m(w.messages):(console.error("String bundle '".concat(e,"' uses an unsupported format.")),function(){return"File bundle has unsupported format. See console for details"})}catch(e){"ENOENT"!==e.code&&console.error("Failed to load single file bundle",e)}return console.error("Failed to load message bundle for file ".concat(e)),function(){return"Failed to load message bundle. See console for details."}}function y(e){return e&&(f(e.locale)&&(c.locale=e.locale.toLowerCase(),c.language=c.locale,l=Object.create(null)),void 0!==e.messageFormat&&(c.messageFormat=e.messageFormat),e.bundleFormat===i.BundleFormat.standalone&&!0===c.languagePackSupport&&(c.languagePackSupport=!1)),(0,i.setPseudo)("pseudo"===c.locale),b}!function(){if(c={locale:void 0,language:void 0,languagePackSupport:!1,cacheLanguageResolution:!0,messageFormat:i.MessageFormat.bundle},f(process.env.VSCODE_NLS_CONFIG))try{var e=JSON.parse(process.env.VSCODE_NLS_CONFIG),n=void 0;if(e.availableLanguages){var r=e.availableLanguages["*"];f(r)&&(n=r)}if(f(e.locale)&&(c.locale=e.locale.toLowerCase()),void 0===n?c.language=c.locale:"en"!==n&&(c.language=n),function(e){return!0===e||!1===e}(e._languagePackSupport)&&(c.languagePackSupport=e._languagePackSupport),f(e._cacheRoot)&&(c.cacheRoot=e._cacheRoot),f(e._languagePackId)&&(c.languagePackId=e._languagePackId),f(e._translationsConfigFile)){c.translationsConfigFile=e._translationsConfigFile;try{c.translationsConfig=g(c.translationsConfigFile)}catch(n){if(e._corruptedFile){var a=o.dirname(e._corruptedFile);t.exists(a,(function(n){n&&t.writeFile(e._corruptedFile,"corrupted","utf8",(function(e){console.error(e)}))}))}}}}catch(e){}(0,i.setPseudo)("pseudo"===c.locale),l=Object.create(null)}(),n.loadMessageBundle=b,n.config=y,a.default.install(Object.freeze({loadMessageBundle:b,config:y}))},8171:e=>{e.exports=require("hbuilderx")},9496:e=>{e.exports=require("vscode")},2081:e=>{e.exports=require("child_process")},7147:e=>{e.exports=require("fs")},1808:e=>{e.exports=require("net")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")}},n={};var r=function r(o){var t=n[o];if(void 0!==t)return t.exports;var a=n[o]={exports:{}};return e[o].call(a.exports,a,a.exports,r),a.exports}(389),o=exports;for(var t in r)o[t]=r[t];r.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();